@model IEnumerable<FridgeSystem.Models.CustomerViewModel>
@{
    ViewData["Title"] = "Customers";
}

<h1 class="dashboard-title">Customers</h1>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}


<div style="margin-bottom: 15px; display:flex; gap:10px;">
    <a asp-controller="CustomerLiaison" asp-action="Dashboard" class="form-button" style="padding: 6px 14px; font-size: 15px;">Back to Dashboard</a>
</div>

<div class="form-container" style="max-width: 1000px; margin:auto;">
    @{
        var statusOptions = new List<SelectListItem>
        {
        new SelectListItem { Text = "All Status", Value = "" },
        new SelectListItem { Text = "Active", Value = "active", Selected = (ViewBag.StatusFilter as string) == "active" },
        new SelectListItem { Text = "Inactive", Value = "inactive", Selected = (ViewBag.StatusFilter as string) == "inactive" }
        };
    }

    <!-- Search + Filter + Add -->
    <form method="get" class="mb-3" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <input type="text" name="searchText" value="@ViewBag.SearchText" placeholder="Search Customers..." class="form-input" style="flex:1; min-width:200px;" />
        @Html.DropDownList("statusFilter", statusOptions, new { @class = "form-input", style = "width:150px;" })
        <button type="submit" class="form-button search-button">Search</button>
        <a asp-action="AddCustomer" class="form-button add-button">Add Customer</a>
    </form>

    <!-- Customer Table -->
    <div class="d-flex justify-content-center">
        <div class="w-100" style="max-width: 1200px;">
            <!-- Customer Table -->
            <table class="table table-striped table-bordered text-center align-middle">
                <thead>
                    <tr>
                        <th>Business Name</th>
                        <th>Email</th>
                        <th>Contact Person</th>
                        <th>Telephone</th>
                        <th>Billing Address</th>
                        <th>Business Type</th>
                        <th>Active</th>
                        <th>Total Locations</th>
                        <th>Date Created</th>
                        <th style="width:240px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var customer in Model)
                        {
                            <tr>
                                <td>@customer.BusinessName</td>
                                <td>@customer.Email</td>
                                <td>@customer.ContactPersonName</td>
                                <td>@customer.Telephone</td>
                                <td>@customer.BillingAddress</td>
                                <td>@customer.BusinessTypeName</td>
                                <td>@(customer.ProfileActive ? "Yes" : "No")</td>
                                <td>@customer.TotalLocations</td>
                                <td>@customer.DateCreated.ToString("yyyy-MM-dd")</td>
                                <td class="d-flex justify-content-center gap-1">
                                    <a asp-action="EditCustomer" asp-route-id="@customer.BusinessId" class="btn btn-sm btn-warning">Edit</a>
                                    <a asp-action="CustomerLocations" asp-route-businessId="@customer.BusinessId" class="btn btn-sm btn-info">Manage Locations</a>
                                    <form asp-action="DeleteCustomer" asp-route-id="@customer.BusinessId" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this customer?');">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="10" class="text-center">No customers found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>





